generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type Otp {
  value     String
  expiresAt DateTime
}

model User {
  id         String      @id @default(auto()) @map("_id") @db.ObjectId
  email      String      @unique
  name       String
  mobile     String
  password   String
  image      String?
  isVerified Boolean     @default(false)
  otp        Otp?
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  roomUser   Room_User[]
  room       Room[]

  @@map("users")
}

model Room {
  id        String      @id @default(auto()) @map("_id") @db.ObjectId
  roomId    String      @unique
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  owner     User        @relation(fields: [ownerId], references: [id])
  ownerId   String      @db.ObjectId
  roomUser  Room_User[]

  @@map("rooms")
}

model Room_User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  room      Room     @relation(fields: [roomId], references: [id])
  roomId    String   @db.ObjectId
  userId    String   @unique @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  peerId    String   @unique
  socketId  String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([roomId, userId])
  @@map("room_users")
}

model Message {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  message   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}
